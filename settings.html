<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>R√©glages Nova</title>
  <style>
    body{
      font-family:system-ui,Arial,sans-serif;
      background:#0f1220; color:#e9edf5;
      margin:0; display:grid; place-items:center; min-height:100vh;
    }
    .card{
      width:min(640px,92%); background:#171a2b;
      border:1px solid #232848; border-radius:16px;
      padding:24px; box-shadow:0 12px 32px rgba(0,0,0,.45);
      display:grid; gap:16px;
    }
    h1{margin:0;font-size:22px}
    label{font-size:14px; color:#9aa4b2; display:block; margin-bottom:6px}
    input[type=text]{width:100%;padding:12px;border-radius:10px;border:1px solid #2c3153;background:#111529;color:#e9edf5}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    button{padding:10px 16px;border:0;border-radius:10px;font-weight:600;cursor:pointer}
    .primary{background:#6ee7b7;color:#0a0d12}
    .secondary{background:#1a1f37;color:#e9edf5;border:1px solid #2c3153}
    .muted{font-size:13px;color:#9aa4b2}
    #msg{margin-top:6px;font-size:14px}
    .ok{color:#86efac} .err{color:#fca5a5}
  </style>
</head>
<body>
  <div class="card">
    <h1>‚öôÔ∏è R√©glages Nova</h1>

    <div>
      <label for="api">URL du backend (Vercel)</label>
      <input id="api" type="text" placeholder="https://yarrow-ai-server.vercel.app">
    </div>

    <div class="row">
      <input type="checkbox" id="autoTts">
      <label for="autoTts">Lecture automatique des r√©ponses</label>
    </div>

    <div class="row">
      <button class="primary" id="save">üíæ Enregistrer</button>
      <button class="secondary" id="test">üß™ Tester</button>
      <a href="./" class="secondary" style="text-decoration:none;display:grid;place-items:center;padding:10px 16px;border-radius:10px">‚¨ÖÔ∏è Retour</a>
    </div>

    <div id="msg" class="muted"></div>
  </div>

  <script>
    const API_KEY = "API_BASE";
    const AUTO_KEY = "AUTO_TTS";
    const input = document.getElementById("api");
    const chk = document.getElementById("autoTts");
    const msg = document.getElementById("msg");

    // Charger valeurs sauvegard√©es
    input.value = localStorage.getItem(API_KEY) || "https://yarrow-ai-server.vercel.app";
    chk.checked = (localStorage.getItem(AUTO_KEY) ?? "1") === "1";

    // Sauver
    document.getElementById("save").onclick = ()=>{
      const val = input.value.trim().replace(/\/+$/,'');
      if(val) localStorage.setItem(API_KEY,val);
      else localStorage.removeItem(API_KEY);
      localStorage.setItem(AUTO_KEY, chk.checked?"1":"0");
      msg.innerHTML = `<span class="ok">‚úÖ R√©glages enregistr√©s.</span>`;
    };

    // Tester
    document.getElementById("test").onclick = async ()=>{
      const base = (input.value||"").trim().replace(/\/+$/,'');
      if(!base){ msg.innerHTML='<span class="err">‚ö†Ô∏è Entre une URL valide.</span>'; return; }
      msg.textContent="Test en cours‚Ä¶";
      try{
        const r = await fetch(base+"/api/ask",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({question:"Ping",site:"hydro"})
        });
        const d = await r.json().catch(()=> ({}));
        if(r.ok) msg.innerHTML=`<span class="ok">‚úÖ R√©ponse : ${d.answer||"OK"}</span>`;
        else msg.innerHTML=`<span class="err">‚ùå Erreur HTTP ${r.status}</span>`;
      }catch(e){
        msg.innerHTML=`<span class="err">‚ùå R√©seau : ${e.message}</span>`;
      }
    };
  </script>
</body>
</html>
